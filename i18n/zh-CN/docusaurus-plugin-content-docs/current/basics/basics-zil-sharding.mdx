---
id: basics-zil-sharding
title: 分片机制
keywords: 
- types of sharding
- network sharding
- transaction sharding
- transaction types
- zilliqa
description: Zilliqa Sharding Mechanism
---

---
import useBaseUrl from '@docusaurus/useBaseUrl';

在本节中，我们将介绍使 Zilliqa 扩展的分片核心思想。 Zilliqa 中的分片有多种形式：*网络分片*、*交易分片*和*计算分片*。 其中最重要的是网络分片，因为其他分片机制都建立在网络分片层之上。

## 网络分片

<img alt="Network sharding" src={useBaseUrl('img/basics/networksharding.png')} />

网络分片（在此语境下，其将被简称为*分片*）是一种机制，其允许 Zilliqa 网络被分成节点更小的组，每个组被称为*分片*。简单地说，假设在有1000个节点的网络中，则可以将网络划分为10组切片，每组切片由节点中的100个为一组组成。

网络分分是秘密武器，它可以让 Zilliqa 具有真正的可扩展性。试想一下，我们例子中的1000个节点的网络。Zilliqa 会自动地将网络划分为每组具有100个节点的10组分片。现在，这些分片可以并行处理交易。如果每个分片每秒能够处理10个交易，那么所有分片一起每秒就可以处理100个交易。其并行处理交易的能力，取决于它的分片架构，此架构可以确保 Zilliqa 网络的吞吐量会随其网络大小的增加而线性增加。

分片的想法当然不是新的，它可以追溯到数据库领域，在那里它被用来提高性能、可扩展性和 I/O 带宽。 然而，在区块链背景下分片的想法首先在由 Zilliqa 团队成员于 2015 年合著的 [学术论文](https://dl.acm.org/doi/10.1145/2976749.2978389) 中提出。

## 交易分片

如上所述，网络分片为并行交易处理开辟了途径——每个分片现在应该能够独立处理交易，从而产生高吞吐量。 每当交易到达网络时，它就会被分配到特定的分片。 分配由交易发送地址的前几位决定。 这称为*交易分片*。

例如，要在具有两个分片 S1 和 S2 的网络中分配交易，我们首先检查发送方的地址。 如果发送方的地址以 0 结尾，则交易应分配给 S1，否则应分配给 S2。

但是，此分配策略仅适用于支付交易。 为了正确处理支付和智能合约交易，通过对交易进行分类而采取不同的解决方案，这样我们就可以为每个类别制定单独的分配策略。

根据所涉及的帐户的类型，网络接收到的交易数据可以分为以下几类。下面，如果它是由用户控制，且未持有合约代码，我们称之为*用户帐户*（或非合约帐户）。作为扩展，持有合约代码的账户被称之为*合约帐户*。

<img alt="Transaction sharding" src={useBaseUrl('img/basics/txnsharding.png')} />

### 类型 I

类型 I (U1 -> U2)：一个用户账户向另一个用户账户发送一些资金，即不涉及智能合约的常规支付交易。 一个示例交易是用户 Alice 向另一个用户 Bob 发送一些 $ZIL。

### 类型 II

类型 II (U -> C)：用户调用智能合约，但被调用的合约不调用任何其他智能合约，合约也不向其他用户转移资金。 即，仅涉及用户帐户和智能合约的交易。 一个示例交易是用户 Alice 向众筹合约捐赠 5 $ZIL。

### 类型 III

类型 III (U1 -> C1 -> … -> Cn [-> U2])：任何其他交易。 此类别包括源自用户的交易，这些交易可以调用一系列合约并可能以用户帐户终止。 一个示例交易是 Alice 调用旅行社合约 (C1)，旅行社合约 (C1) 调用航空公司合约 (C2)，然后航空公司合约 (C2) 再调用保险合约 (C3)。

### 分配策略

在任何给定时间，每个分片将只处理 I 类和 II 类交易，而 DS 委员会仅在 I 类和 II 类交易被其余分片验证后才会处理 III 类交易。 DS 委员会也可能处理某些类型 I 或 II 的交易。 请注意，DS 委员会不会并行处理交易（对分片而言）； 否则，就有可能发生双花。

具体的分配策略如下：

1. 对于具有 k = 2^n 个分片的网络，每个分片将仅处理类型 I 和 II 的交易，其中发送者和接收者的地址具有相同的最后 n 位。

2. 任何其他交易（包括类型 III）将由DS委员会进行处理，而这必须在其它分片完成处理交易之后。